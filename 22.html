 
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœªå‘½åæ¸¬é©—</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; background-color: #37474F; color: #ECEFF1; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: #263238; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4); }
        .question { margin-bottom: 30px; padding: 20px; border: 1px solid #455A64; border-radius: 6px; }
        .q-text { font-size: 1.2em; font-weight: bold; margin-bottom: 15px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-btn { display: block; width: 100%; padding: 10px; border: none; border-radius: 4px; background: #546E7A; color: white; cursor: pointer; text-align: left; transition: background 0.2s; }
        .option-btn:hover:not(:disabled) { background: #78909C; }
        .feedback { font-weight: bold; margin-top: 15px; padding: 10px; border-radius: 4px; }
        .correct { color: #4CAF50; background-color: #384E41; }
        .wrong { color: #E53935; background-color: #4E3E40; }
        .image-placeholder { color: #90CAF9; font-size: 0.9em; } 
        #open-answer { padding: 10px; width: 90%; max-width: 300px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #455A64; background: #546E7A; color: white; }
        .disabled-btn { opacity: 0.6; cursor: not-allowed; }
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; } 
        }
        .question img { max-width: 100%; height: auto; display: block; margin: 0 auto 15px; border-radius: 4px; border: 1px solid #455A64; }
        
        /* åª’é«”æŸ¥è©¢ï¼šåˆ—å°æ¨¡å¼ (é—œéµï¼šéš±è—æŒ‰éˆ•ã€ç¢ºä¿ç™½åº•é»‘å­—) */
        @media print { 
            body { background-color: white !important; color: black !important; padding: 0 !important; }
            .container { box-shadow: none; border: none; background: white !important; color: black !important; padding: 10px !important; max-width: none; }
            .question { border: 1px solid #ccc; background-color: #f9f9f9 !important; page-break-inside: avoid; }
            .q-text { color: black !important; }
            .feedback { border: 1px solid #ccc; }
            /* è®“ç­”æ¡ˆ/è§£æåœ¨åˆ—å°æ™‚é¡¯ç¤ºç‚ºé»‘è‰²ï¼Œç¢ºä¿å¯è®€æ€§ */
            .correct, .wrong { background-color: #e0e0e0 !important; color: black !important; }
            /* éš±è—ä½œç­”å€å’Œåˆ†æ•¸æŒ‰éˆ• */
            .options-grid, #open-answer, #score-container button, #progress-display, #student-info-form { display: none !important; } 
            
            /* é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆçš„æ¨™ç±¤ */
            .correct-answer-label { display: block !important; color: #000; font-weight: bold; margin-top: 5px; }
        }
        #progress-display { font-size: 1.1em; color: #BBBBBB; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>æœªå‘½åæ¸¬é©—</h1>
        
        <div id="student-info-form" style="margin-bottom: 20px; padding: 20px; border: 1px solid #FFA000; border-radius: 4px;">
            <p style="color: #FFA000; font-weight: bold;">è«‹å…ˆè¼¸å…¥è€ƒç”Ÿè³‡è¨Šï¼š</p>
            <label for="class-id">ç­ç´š/åº§è™Ÿ:</label>
            <input type="text" id="class-id" placeholder="ä¾‹å¦‚: 101-05" style="padding: 5px; margin-bottom: 10px; width: 150px; background: #546E7A; color: white; border: 1px solid #455A64;">
            <label for="student-name">è€ƒç”Ÿå§“å:</label>
            <input type="text" id="student-name" placeholder="ä¾‹å¦‚: ç‹å°æ˜" style="padding: 5px; margin-bottom: 10px; width: 150px; background: #546E7A; color: white; border: 1px solid #455A64;">
            <button onclick="startQuizWeb()" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">é–‹å§‹æ¸¬é©—</button>
        </div>
        
        <div id="progress-display" style="display: none;"></div>
        <div id="quiz-container">è«‹è¼¸å…¥è€ƒç”Ÿè³‡è¨Šå¾Œé–‹å§‹æ¸¬é©—...</div>
        <div id="score-container" style="margin-top: 30px; font-size: 1.1em; color: #BBBBBB;"></div>
    </div>

    <script>
        const quizData = JSON.parse('[{"type": 1, "text": "Python æ˜¯ä¸€ç¨®è§£é‡‹å‹èªè¨€ã€‚", "answer": "O", "options": {}, "image": "example_image.png"}, {"type": 2, "text": "å“ªå€‹æ˜¯æ­£ç¢ºé¸é …ï¼Ÿ", "answer": "E", "options": {"A": "é¸é …ä¸€", "B": "é¸é …äºŒ", "E": "é¸é …äº”"}, "image": "example_image2.jpg"}, {"type": 3, "text": "ä»Šå¤©çš„æ—¥æœŸæ˜¯ï¼Ÿ", "answer": "10æœˆ6æ—¥", "options": {}, "image": null}, {"type": 1, "text": "è«‹æ ¹æ“šåœ–ç‰‡ä½œç­”ï¼š1.jpg", "answer": "O", "options": {}, "image": "1.jpg"}, {"type": 2, "text": "è«‹æ ¹æ“šåœ–ç‰‡ä½œç­”ï¼š3.jpg", "answer": "E", "options": {"A": "é¸é …A", "B": "é¸é …B", "C": "é¸é …C", "D": "é¸é …D", "E": "é¸é …E"}, "image": "3.jpg"}, {"type": 3, "text": "è«‹æ ¹æ“šåœ–ç‰‡ä½œç­”ï¼š4.jpg", "answer": "HH", "options": {}, "image": "4.jpg"}, {"type": 1, "text": "è«‹æ ¹æ“šåœ–ç‰‡ä½œç­”ï¼š2.jpg", "answer": "X", "options": {}, "image": "2.jpg"}]'); 
        let currentQuestionIndex = 0;
        let score = 0;
        let answeredCount = 0;
        const container = document.getElementById('quiz-container');
        const scoreContainer = document.getElementById('score-container');
        const progressDisplay = document.getElementById('progress-display');
        const infoForm = document.getElementById('student-info-form');
        
        let studentClassId = '';
        let studentName = '';
        
        const imagePathPrefix = 'images/'; 
        
        const answeredQuestions = [];

        function startQuizWeb() {
            studentClassId = document.getElementById('class-id').value.trim();
            studentName = document.getElementById('student-name').value.trim();
            
            if (!studentClassId || !studentName) {
                alert("è«‹å¡«å¯«ç­ç´š/åº§è™Ÿå’Œè€ƒç”Ÿå§“åï¼");
                return;
            }

            infoForm.style.display = 'none';
            progressDisplay.style.display = 'block';

            const urlParams = new URLSearchParams(window.location.search);
            const isRandom = urlParams.get('mode') === 'random';
            
            if (quizData && quizData.length > 0) {
                if (isRandom) {
                    quizData.sort(() => Math.random() - 0.5);
                }
                showQuestion(currentQuestionIndex);
            } else {
                container.innerHTML = '<h2 style="color:orange;">é¡Œç›®æ•¸æ“šè¼‰å…¥å¤±æ•—ã€‚</h2>';
            }
        }

        function showQuestion(index) {
            if (index >= quizData.length) {
                showResults();
                return;
            }
            
            const q = quizData[index];
            let html = `<div class="question" id="q-${index}">`;
            html += `<div class="q-text">ç¬¬ ${index + 1} é¡Œ: ${q.text}</div>`;
            
            if (q.image) {
                html += `<img src="${imagePathPrefix}${q.image}" alt="é¡Œç›®åœ–ç‰‡" onerror="this.outerHTML='<p class=\'image-placeholder\'>åœ–ç‰‡è¼‰å…¥å¤±æ•— (æª”æ¡ˆ: ${imagePathPrefix}${q.image} - è«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦åœ¨ images è³‡æ–™å¤¾å…§)</p>'">`;
            }

            html += `<div class="options-grid" id="options-${index}">`;
            
            if (q.type === 1) { // æ˜¯éé¡Œ (O/X)
                html += `<button class="option-btn" data-answer="O" data-index="${index}" style="grid-column: span 1;">â­• æ˜¯</button>`;
                html += `<button class="option-btn" data-answer="X" data-index="${index}" style="grid-column: span 1;">âŒ é</button>`;
            } else if (q.type === 2) { // é¸æ“‡é¡Œ (A-E)
                const optionKeys = ['A', 'B', 'C', 'D', 'E'];
                optionKeys.forEach(key => {
                    if(q.options[key]) {
                        html += `<button class="option-btn" data-answer="${key}" data-index="${index}">${key}. ${q.options[key]}</button>`;
                    }
                });
            } else if (q.type === 3) { // é–‹æ”¾å¼
                html += `<div style="grid-column: span 2;">`; 
                html += `<input type="text" id="open-answer-${index}" maxlength="10" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ (æœ€å¤š10å­—)" style="text-transform: uppercase;">`;
                html += `<button class="option-btn" data-index="${index}" onclick="checkOpenAnswer(event)" style="background: #4CAF50;">ç¢ºèªé€å‡º</button>`;
                html += `</div>`;
            }
            html += `</div>`;
            html += `<div class="feedback" id="feedback-${index}"></div>`;
            html += `<div class="correct-answer-label" style="display:none; color: #4CAF50;">âœ… æ­£ç¢ºç­”æ¡ˆï¼š${q.answer}</div>`; // ä¾›åˆ—å°æ™‚é¡¯ç¤º
            html += `</div>`;
            container.innerHTML = html;
            
            if (q.type === 1 || q.type === 2) {
                document.querySelectorAll(`#options-${index} .option-btn`).forEach(btn => {
                    if (!btn.getAttribute('onclick')) {
                        btn.onclick = (e) => checkMultipleChoice(index, e.target);
                    }
                });
            }
            updateScoreDisplay();
        }

        function disableAllButtons(index) {
            const optionsArea = document.getElementById(`options-${index}`);
            optionsArea.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('disabled-btn');
            });
        }

        function checkMultipleChoice(index, button) {
            const q = quizData[index];
            const userAnswer = button.getAttribute('data-answer');
            const feedbackElement = document.getElementById('feedback-' + index);
            const isCorrect = userAnswer === q.answer;
            answeredCount++;

            answeredQuestions[index] = {
                ...q,
                userAnswer: userAnswer,
                isCorrect: isCorrect,
                questionIndex: index
            };

            if (isCorrect) {
                feedbackElement.innerHTML = 'âœ… æ­£ç¢ºï¼';
                feedbackElement.classList.add('correct');
                score++;
                button.style.backgroundColor = '#4CAF50';
                setTimeout(showNextQuestion, 1000);
            } else {
                feedbackElement.innerHTML = `âŒ éŒ¯èª¤ï¼æ‚¨é¸äº† ${userAnswer}ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${q.answer}`;
                feedbackElement.classList.add('wrong');
                button.style.backgroundColor = '#E53935';
                document.querySelectorAll(`#options-${index} .option-btn`).forEach(btn => {
                    if (btn.getAttribute('data-answer') === q.answer) {
                        btn.style.border = '3px solid #FFA000';
                        btn.style.backgroundColor = '#FFA000'; 
                    }
                });
                setTimeout(showNextQuestion, 2000);
            }
            disableAllButtons(index);
            updateScoreDisplay();
        }

        function checkOpenAnswer(event) {
            const index = parseInt(event.target.getAttribute('data-index'));
            const q = quizData[index];
            const inputElement = document.getElementById('open-answer-' + index);
            const userAnswer = inputElement.value.toUpperCase().trim();
            const feedbackElement = document.getElementById('feedback-' + index);
            const isCorrect = userAnswer === q.answer;
            answeredCount++;
            
            answeredQuestions[index] = {
                ...q,
                userAnswer: userAnswer,
                isCorrect: isCorrect,
                questionIndex: index
            };


            if (isCorrect) {
                feedbackElement.innerHTML = 'âœ… æ­£ç¢ºï¼';
                feedbackElement.classList.add('correct');
                score++;
            } else {
                feedbackElement.innerHTML = `âŒ éŒ¯èª¤ï¼æ‚¨å¯«äº† ${userAnswer}ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${q.answer}`;
                feedbackElement.classList.add('wrong');
            }

            inputElement.disabled = true;
            disableAllButtons(index);
            updateScoreDisplay();
            
            const nextButton = document.createElement('button');
            nextButton.textContent = 'ä¸‹ä¸€é¡Œ >>';
            nextButton.style.cssText = "padding: 10px 20px; background: #1976D2; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 20px; font-weight: bold; width: 100%;";
            nextButton.onclick = showNextQuestion;
            document.getElementById(`q-${index}`).appendChild(nextButton);
        }

        function showNextQuestion() {
            currentQuestionIndex++;
            showQuestion(currentQuestionIndex);
        }

        function updateScoreDisplay() {
            const totalQ = quizData.length;
            const finalScore = totalQ > 0 ? ((score / totalQ) * 100).toFixed(1) : 0;
            const correctQ = score;
            const wrongQ = answeredCount - correctQ;
            progressDisplay.innerHTML = `é€²åº¦: ${answeredCount}/${totalQ} é¡Œ | æ­£ç¢º: ${correctQ} | éŒ¯èª¤: ${wrongQ} | ç›®å‰å¾—åˆ†: ${finalScore}/100`;
        }

        function showResults() {
            const finalScore = quizData.length > 0 ? ((score / quizData.length) * 100).toFixed(1) : 0;
            const wrongCount = answeredQuestions.filter(q => q && !q.isCorrect).length;
            
            let resultHTML = `<h2 style="color: #FFA000;">${document.querySelector('h1').textContent}</h2>`;
            resultHTML += `<p style="font-weight: bold; margin-bottom: 20px;">è€ƒç”Ÿ: ${studentClassId} ${studentName}</p>`;
            resultHTML += `<h2>æ¸¬é©—å®Œæˆï¼</h2>
                           <p>ç¸½é¡Œæ•¸ï¼š${quizData.length} é¡Œ | æ­£ç¢ºï¼š${score} é¡Œ | éŒ¯èª¤ï¼š${wrongCount} é¡Œ</p>`;
            
            if (wrongCount > 0) {
                resultHTML += `<h3 style="color: #E53935; margin-top: 20px;">âŒ éŒ¯é¡Œå›é¡§èˆ‡è§£æ âŒ</h3>`;
                
                answeredQuestions.forEach((q, index) => {
                    if (q && !q.isCorrect) {
                        const imgTag = q.image ? `<img src="${imagePathPrefix}${q.image}" alt="é¡Œç›®åœ–ç‰‡">` : '';
                        resultHTML += `<div class="question wrong">
                                         <div class="q-text">ã€éŒ¯é¡Œ ${index + 1}ã€‘ ${q.text}</div>
                                         ${imgTag}
                                         <div class="feedback wrong">
                                            æ‚¨çš„ç­”æ¡ˆ: ${q.userAnswer}<br>
                                            âœ… æ­£ç¢ºç­”æ¡ˆ: ${q.answer}
                                         </div>
                                       </div>`;
                    }
                });
                
                resultHTML += `<p style="color: #FFA000; margin-top: 20px; font-weight: bold;">è«‹ä½¿ç”¨ä¸‹æ–¹çš„æŒ‰éˆ•åˆ—å°æ­¤é é¢ï¼Œå³å¯å„²å­˜éŒ¯é¡Œè§£æè¤‡ç¿’ PDFï¼</p>`;
            }

            container.innerHTML = resultHTML;
            
            scoreContainer.innerHTML = `<h3 style="color: #4CAF50;">ğŸ‰ æœ€çµ‚å¾—åˆ†: ${finalScore} / 100</h3> 
                                        <button onclick="window.print()" style="padding: 15px 30px; background: #D32F2F; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 15px; font-weight: bold; font-size: 1.2em;">
                                            â¬‡ï¸ åˆ—å°éŒ¯é¡Œè¤‡ç¿’ / å¦å­˜ PDF ä¸‹è¼‰
                                        </button>`;
            
            progressDisplay.style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('mode') === 'random') {
                 document.getElementById('student-info-form').querySelector('p').textContent = "ã€éš¨æ©Ÿæ¨¡å¼ã€‘è«‹å…ˆè¼¸å…¥è€ƒç”Ÿè³‡è¨Šï¼š";
            }
        });
    </script>
</body>
</html>
